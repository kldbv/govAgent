import{i as U,n as $,r as l,j as e,U as q,k as B,E as T,o as X,m as I,p as O,q as V,z as f,t as G,C as H,h as J}from"./index-e5c67441.js";import{X as C,F as S,A as K}from"./x-circle-57091fc4.js";import{S as W}from"./search-c5427502.js";import{F as Y}from"./filter-0b1c5058.js";const Z=U("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);function te(){const[A]=$(),[m,N]=l.useState([]),[p,v]=l.useState(!0),[b,M]=l.useState(""),[c,D]=l.useState(""),[o,E]=l.useState(A.get("status")||""),[x,j]=l.useState(1),[i,L]=l.useState(null),[s,y]=l.useState(null),[F,w]=l.useState(!1),[d,_]=l.useState({}),h=async(a=1,r=c,t=o)=>{try{v(!0);const n={page:a,limit:20};r.trim()&&(n.search=r.trim()),t&&(n.status=t);const g=await O(n);if(g&&g.data)N(g.data.applications||[]),L(g.data.pagination||null);else throw new Error("Invalid response format")}catch(n){M(n.message||"Failed to load applications"),console.error("Error loading applications:",n)}finally{v(!1)}};l.useEffect(()=>{h(1,c,o),j(1)},[c,o]);const u=async(a,r)=>{try{_(t=>({...t,[a]:!0})),await V(a,r),N(m.map(t=>t.id===a?{...t,status:r}:t)),s&&s.id===a&&y({...s,status:r}),f.success("Статус заявки обновлен!")}catch(t){f.error(t.message||"Failed to update application status"),console.error("Error updating application status:",t)}finally{_(t=>({...t,[a]:!1}))}},P=async a=>{var r;try{w(!0);const t=await G(a);console.log("Application details response:",t);const n=((r=t.data)==null?void 0:r.application)||t.data;console.log("Application data:",n),y(n)}catch(t){f.error(t.message||"Failed to load application details"),console.error("Error loading application details:",t)}finally{w(!1)}},k=a=>{switch(a){case"pending":return"bg-yellow-100 text-yellow-800";case"under_review":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=a=>{switch(a){case"pending":return"В ожидании";case"under_review":return"На рассмотрении";case"approved":return"Одобрена";case"rejected":return"Отклонена";default:return a}},R=a=>{switch(a){case"pending":return e.jsx(J,{className:"w-4 h-4"});case"under_review":return e.jsx(K,{className:"w-4 h-4"});case"approved":return e.jsx(H,{className:"w-4 h-4"});case"rejected":return e.jsx(C,{className:"w-4 h-4"});default:return null}};return p&&m.length===0?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"loading-spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Загружаем заявки..."})]})}):b?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:b}),e.jsx("button",{onClick:()=>h(),className:"btn-primary",children:"Попробовать снова"})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Управление заявками"}),e.jsx("p",{className:"text-gray-600",children:"Просмотр и обработка заявок на участие в программах"})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Детали заявки #",s.id]}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Информация о заявителе"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Имя:"})," ",s.user_name||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",s.user_email||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Тип бизнеса:"})," ",s.business_type||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Размер бизнеса:"})," ",s.business_size||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Отрасль:"})," ",s.industry||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Регион:"})," ",s.region||"Не указано"]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Бизнес-показатели"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Текущая выручка:"})," ",s.annual_revenue||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Количество сотрудников:"})," ",s.employee_count||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Запрашиваемое финансирование:"})," ",s.funding_request||"Не указано"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Ожидаемая ROI:"})," ",s.expected_roi||"Не указано"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["Программа: ",s.program_name]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[R(s.status),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k(s.status)}`,children:z(s.status)})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Краткое описание бизнес-плана"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.business_plan_summary||"Не указано"})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Временные рамки реализации"}),e.jsx("p",{className:"text-gray-700",children:s.timeline||"Не указано"})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Даты"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Подана:"})," ",s.submitted_at?new Date(s.submitted_at).toLocaleDateString("ru-RU"):"Invalid Date"]}),s.reviewed_at&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Рассмотрена:"})," ",new Date(s.reviewed_at).toLocaleDateString("ru-RU")]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>u(s.id,"under_review"),disabled:s.status==="under_review"||d[s.id],className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d[s.id]&&s.status!=="under_review"?"Обновление...":"На рассмотрение"}),e.jsx("button",{onClick:()=>u(s.id,"approved"),disabled:s.status==="approved"||d[s.id],className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d[s.id]&&s.status!=="approved"?"Обновление...":"Одобрить"}),e.jsx("button",{onClick:()=>u(s.id,"rejected"),disabled:s.status==="rejected"||d[s.id],className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d[s.id]&&s.status!=="rejected"?"Обновление...":"Отклонить"})]})]})]})}),e.jsx("div",{className:"card p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Поиск по заявителю или программе...",value:c,onChange:a=>D(a.target.value),className:"input-field pl-10 w-full"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsxs("select",{value:o,onChange:a=>E(a.target.value),className:"input-field pl-10 pr-8",children:[e.jsx("option",{value:"",children:"Все статусы"}),e.jsx("option",{value:"pending",children:"В ожидании"}),e.jsx("option",{value:"under_review",children:"На рассмотрении"}),e.jsx("option",{value:"approved",children:"Одобренные"}),e.jsx("option",{value:"rejected",children:"Отклоненные"})]})]})})]})}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-gray-500"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Заявки на участие",i&&` (${i.total})`]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Заявитель"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Программа"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Запрашиваемое финансирование"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Дата подачи"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.user_name}),e.jsx("div",{className:"text-sm text-gray-500",children:a.user_email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:a.program_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:a.status,onChange:r=>u(a.id,r.target.value),disabled:d[a.id],className:`text-xs font-medium px-2 py-1 rounded-full border-0 ${k(a.status)} ${d[a.id]?"opacity-50 cursor-not-allowed":"cursor-pointer hover:shadow-md"}`,children:[e.jsx("option",{value:"pending",children:"В ожидании"}),e.jsx("option",{value:"under_review",children:"На рассмотрении"}),e.jsx("option",{value:"approved",children:"Одобрена"}),e.jsx("option",{value:"rejected",children:"Отклонена"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.funding_request}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.submitted_at).toLocaleDateString("ru-RU")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>P(a.id),disabled:F,className:"text-blue-600 hover:text-blue-900 disabled:opacity-50",title:"Просмотреть детали",children:e.jsx(T,{className:"w-4 h-4"})})})]},a.id))})]})}),m.length===0&&!p&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Заявки не найдены"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:c||o?"Попробуйте изменить критерии поиска":"Заявки еще не поданы"})]}),i&&i.total_pages>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Показано ",(x-1)*i.per_page+1," - ",Math.min(x*i.per_page,i.total)," из ",i.total," заявок"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const a=x-1;j(a),h(a,c,o)},disabled:x===1||p,className:"btn-secondary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded",children:[x," / ",i.total_pages]}),e.jsx("button",{onClick:()=>{const a=x+1;j(a),h(a,c,o)},disabled:x===i.total_pages||p,className:"btn-secondary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(I,{className:"w-4 h-4"})})]})]})})]})]})}export{te as A};
