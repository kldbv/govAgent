import{u as A,b as P,r as t,j as e,L as k,c as R,g as L}from"./index-e5c67441.js";const O=[{value:"score_desc",label:"По соответствию (сначала высокое)"},{value:"deadline_asc",label:"По дедлайну (сначала ближайшие)"},{value:"funding_desc",label:"По финансированию (сначала больше)"}];function V(){const{isAuthenticated:N}=A(),F=P(),[m,v]=t.useState(!0),[u,b]=t.useState(""),[i,T]=t.useState([]),[d,E]=t.useState("score_desc"),[x,y]=t.useState(""),[g,_]=t.useState(""),[h,S]=t.useState(""),[p,w]=t.useState(""),[f,C]=t.useState(""),j=async()=>{try{v(!0),b("");const s=await L();T(Array.isArray(s)?s:[])}catch(s){b(s.message||"Не удалось загрузить рекомендации")}finally{v(!1)}};t.useEffect(()=>{if(!N){F("/login");return}j()},[N]);const M=t.useMemo(()=>{const s=new Set;return i.forEach(r=>r.program_type&&s.add(r.program_type)),Array.from(s)},[i]),D=t.useMemo(()=>{const s=new Set;return i.forEach(r=>{var o;return(o=r.eligible_regions)==null?void 0:o.forEach(a=>a&&s.add(a))}),Array.from(s)},[i]),I=t.useMemo(()=>{const s=new Date,r=parseInt(f||"0",10);let o=i.filter(a=>{if(x&&a.program_type!==x)return!1;if(g){const l=a.eligible_regions;if(!l||!l.includes(g))return!1}const n=a.funding_amount;if(h&&n!==void 0&&n<Number(h)||p&&n!==void 0&&n>Number(p))return!1;if(r>0&&a.application_deadline){const l=new Date(a.application_deadline),c=Math.ceil((l.getTime()-s.getTime())/(1e3*60*60*24));if(c<0||c>r)return!1}return!0});return o.sort((a,n)=>{if(d==="score_desc"){const l=Math.round(a.score??0);return Math.round(n.score??0)-l}if(d==="deadline_asc"){const l=a.application_deadline?new Date(a.application_deadline).getTime():Number.POSITIVE_INFINITY,c=n.application_deadline?new Date(n.application_deadline).getTime():Number.POSITIVE_INFINITY;return l-c}if(d==="funding_desc"){const l=a.funding_amount??0;return(n.funding_amount??0)-l}return 0}),o},[i,d,x,g,h,p,f]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Рекомендации"}),e.jsx("button",{onClick:j,className:"btn-secondary",children:"Обновить"})]}),e.jsxs("div",{className:"card p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Сортировка"}),e.jsx("select",{className:"input-field",value:d,onChange:s=>E(s.target.value),children:O.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Тип программы"}),e.jsxs("select",{className:"input-field",value:x,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"Все"}),M.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Регион"}),e.jsxs("select",{className:"input-field",value:g,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"",children:"Все"}),D.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Мин. финансирование (₸)"}),e.jsx("input",{className:"input-field",type:"number",min:0,value:h,onChange:s=>S(s.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Макс. финансирование (₸)"}),e.jsx("input",{className:"input-field",type:"number",min:0,value:p,onChange:s=>w(s.target.value),placeholder:""})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Дедлайн в течение (дней)"}),e.jsx("input",{className:"input-field",type:"number",min:0,value:f,onChange:s=>C(s.target.value),placeholder:"30"})]})]}),e.jsx("div",{className:"flex justify-end mt-3 gap-3",children:e.jsx("button",{className:"btn-ghost",onClick:()=>{y(""),_(""),S(""),w(""),C("")},children:"Сбросить"})})]}),m&&e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"loading-spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Загружаем персональные рекомендации…"})]}),!m&&u&&e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:u}),e.jsx("button",{onClick:j,className:"btn-primary",children:"Повторить"})]}),!m&&!u&&i.length===0&&e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Пока нет рекомендаций. Заполните профиль, чтобы мы могли подобрать программы."}),e.jsx(k,{to:"/profile",className:"btn-primary",children:"Перейти к профилю"})]}),!m&&!u&&i.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:["Найдено: ",I.length]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(s=>e.jsx(R,{program:s,showMatchScore:!0,className:"h-full"},s.id))})]})]})}export{V as default};
